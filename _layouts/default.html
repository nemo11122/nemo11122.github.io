<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>{{ page.title }} | {{ site.title }}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="/css/style.css" />
</head>
<body>
  {% include header.html %}

  <div class="main-container">
    <main class="posts-area">
      <!-- 🔹 包住頁面原始內容（可在搜尋時隱藏） -->
      <div id="page-content">
        {{ content }}
      </div>

      <!-- 🔹 搜尋結果 + 首頁文章區塊 -->
      {% include search-block.html %}
    </main>

    {% include sidebar.html %}
  </div>

  {% include footer.html %}

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const sidebarInput = document.getElementById("search-input");
      const mainInput = document.getElementById("main-search-input");
      const resultSection = document.getElementById("search-result-section");
      const resultTitle = document.getElementById("search-result-title");
      const resultList = document.getElementById("search-results");
      const homepage = document.getElementById("homepage-posts");
      const contentArea = document.getElementById("page-content");

      let data = [];

      // 載入搜尋資料
      fetch("/search.json")
        .then(res => res.json())
        .then(json => { data = json; });

      function performSearch(keyword) {
        const q = keyword.trim().toLowerCase();
        if (!q) return;

        if (homepage) homepage.style.display = "none";
        if (contentArea) contentArea.style.display = "none";
        if (resultSection) resultSection.style.display = "block";

        resultList.innerHTML = "";
        resultTitle.innerHTML = `Search results for: <mark>${q}</mark>`;
        if (mainInput) mainInput.value = keyword;

        const results = data.filter(post =>
          post.title.toLowerCase().includes(q) ||
          post.excerpt.toLowerCase().includes(q)
        );

        if (results.length === 0) {
          resultList.innerHTML = `
            <div class="search-not-found">
              <h2>Nothing Found</h2>
              <p>Sorry, but nothing matched your search criteria. Please try again with some different keywords.</p>
            </div>
          `;
          return;
        }

        results.forEach(post => {
  const container = document.createElement("div");
  container.className = "post-item";

  // 圖片
  if (post.image) {
    const img = document.createElement("img");
    img.src = post.image;
    img.className = "post-image";
    container.appendChild(img);
  }

  // 日期
  const date = document.createElement("div");
  date.className = "post-date";
  date.textContent = post.date || "";
  container.appendChild(date);

  // 標題
  const title = document.createElement("h2");
  title.className = "post-title";
  const link = document.createElement("a");
  link.href = post.url;
  link.textContent = post.title;
  title.appendChild(link);
  container.appendChild(title);

  // 摘要
  const excerpt = document.createElement("div");
  excerpt.className = "post-excerpt";
  excerpt.textContent = post.excerpt;
  container.appendChild(excerpt);

  // Continue reading →
  const readMore = document.createElement("a");
  readMore.href = post.url;
  readMore.textContent = "Continue reading →";
  readMore.className = "read-more";
  container.appendChild(readMore);

  // 作者
  if (post.author) {
    const author = document.createElement("p");
    author.innerHTML = 'Written by <strong>' + post.author + '</strong>';
    author.style.fontSize = "0.9em";
    author.style.color = "#999";
    container.appendChild(author);
  }

  // 類別
  if (post.categories && post.categories.length > 0) {
    const metaFooter = document.createElement("div");
    metaFooter.className = "post-meta-footer";
    metaFooter.innerHTML = "Posted in " + post.categories.map(cat => {
      return `<a href="/categories/${cat.toLowerCase()}">${cat}</a>`;
    }).join(", ");
    container.appendChild(metaFooter);
  }

  // 分隔線
  const hr = document.createElement("hr");
  container.appendChild(hr);

  resultList.appendChild(container);
});


      // 🔎 Sidebar 搜尋觸發
      if (sidebarInput) {
        sidebarInput.addEventListener("keydown", function (e) {
          if (e.key === "Enter") {
            e.preventDefault();
            performSearch(this.value);
          }
        });
      }

      // 🔎 主搜尋框觸發
      if (mainInput) {
        mainInput.addEventListener("keydown", function (e) {
          if (e.key === "Enter") {
            e.preventDefault();
            performSearch(this.value);
          }
        });
      }
    });
  </script>
</body>
</html>


