<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>{{ page.title }} | {{ site.title }}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="/css/style.css" />
</head>
<body>
  {% include header.html %}

  <div class="main-container">
    <main class="posts-area">
      <!-- üîπ ÂåÖ‰ΩèÈ†ÅÈù¢ÂéüÂßãÂÖßÂÆπÔºàÂèØÂú®ÊêúÂ∞ãÊôÇÈö±ËóèÔºâ -->
      <div id="page-content">
        {{ content }}
      </div>

      <!-- üîπ ÊêúÂ∞ãÁµêÊûú + È¶ñÈ†ÅÊñáÁ´†ÂçÄÂ°ä -->
      {% include search-block.html %}
    </main>

    {% include sidebar.html %}
  </div>

  {% include footer.html %}

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const sidebarInput = document.getElementById("search-input");
      const mainInput = document.getElementById("main-search-input");
      const resultSection = document.getElementById("search-result-section");
      const resultTitle = document.getElementById("search-result-title");
      const resultList = document.getElementById("search-results");
      const homepage = document.getElementById("homepage-posts");
      const contentArea = document.getElementById("page-content");

      let data = [];

      // ËºâÂÖ•ÊêúÂ∞ãË≥áÊñô
      fetch("/search.json")
        .then(res => res.json())
        .then(json => { data = json; });

      function performSearch(keyword) {
        const q = keyword.trim().toLowerCase();
        if (!q) return;

        if (homepage) homepage.style.display = "none";
        if (contentArea) contentArea.style.display = "none";
        if (resultSection) resultSection.style.display = "block";

        resultList.innerHTML = "";
        resultTitle.innerHTML = `Search results for: <mark>${q}</mark>`;
        if (mainInput) mainInput.value = keyword;

        const results = data.filter(post =>
          post.title.toLowerCase().includes(q) ||
          post.excerpt.toLowerCase().includes(q)
        );

        if (results.length === 0) {
          resultList.innerHTML = `
            <div class="search-not-found">
              <h2>Nothing Found</h2>
              <p>Sorry, but nothing matched your search criteria. Please try again with some different keywords.</p>
            </div>
          `;
          return;
        }

        results.forEach(post => {
          const container = document.createElement("div");
          container.className = "post-item";

          if (post.image) {
            const img = document.createElement("img");
            img.src = post.image;
            img.className = "post-image";
            container.appendChild(img);
          }

          const date = document.createElement("div");
          date.className = "post-date";
          date.textContent = post.date || "";

          const title = document.createElement("h2");
          title.className = "post-title";
          const link = document.createElement("a");
          link.href = post.url;
          link.textContent = post.title;
          title.appendChild(link);

          const excerpt = document.createElement("div");
          excerpt.className = "post-excerpt";
          excerpt.textContent = post.excerpt;

          container.appendChild(date);
          container.appendChild(title);
          container.appendChild(excerpt);
          resultList.appendChild(container);
        });
      }

      // üîé Sidebar ÊêúÂ∞ãËß∏Áôº
      if (sidebarInput) {
        sidebarInput.addEventListener("keydown", function (e) {
          if (e.key === "Enter") {
            e.preventDefault();
            performSearch(this.value);
          }
        });
      }

      // üîé ‰∏ªÊêúÂ∞ãÊ°ÜËß∏Áôº
      if (mainInput) {
        mainInput.addEventListener("keydown", function (e) {
          if (e.key === "Enter") {
            e.preventDefault();
            performSearch(this.value);
          }
        });
      }
    });
  </script>
</body>
</html>


